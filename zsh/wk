# Taken from github.com/bitprophet/dotfiles

# Generic "move me to my project dir" function/alias.
#
# Tries to "workon" a Python virtualenv, then (either way) switches to the
# directory in question.
#
# This means that we can A) use this for non-Python projects, and B) avoid
# having to add the 'cd' call to every. single. virtualenv's postactivate
# script.
#
# Also deactivates any currently active virtualenv, just for neatness' sake.
#
CODE=$HOME/Code/src
RCFILE=".wkrc"

function wk() {
    # deactivate/workon will fail silently if project is not a virtualenv.
    deactivate 2>/dev/null
    workon $1 2>/dev/null

    # Try to find the given folder and cd to it.
    # It should be in $CODE/$1, or $CODE/github.com/$1, or
    # $CODE/bitbucket.org/$1
    FOLDERS=($CODE $CODE/github.com $CODE/bitbucket.org)
    for folder in $FOLDERS; do
        target=$folder/$1
        if [[ -d $target ]]; then
            cd $target
            # Also execute any project init file
            if [[ -f $RCFILE ]]; then
                . $RCFILE
            fi
            return 0
        fi
    done
    return 1
}

# Completion
function _wk() {
    compadd $(find $CODE -type d -mindepth 1 -maxdepth 3 | \
                ag --nocolor -v '(github.com|bitbucket.org)(/[^\/]+)?$' | \
                sed -E "s:^$CODE/((github.com|bitbucket.org)/)?::" 2>/dev/null)
}

compdef _wk wk
